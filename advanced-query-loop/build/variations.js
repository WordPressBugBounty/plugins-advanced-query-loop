var aql;(()=>{"use strict";var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{AQL:()=>ee,AQLControls:()=>c,AQLControlsInheritedQuery:()=>p});const r=window.wp.blocks,a=window.wp.i18n,n=window.React,l=window.wp.hooks,o=window.wp.blockEditor,u=window.wp.components,{Fill:d,Slot:i}=(0,u.createSlotFill)("AQLControls"),s=({children:e})=>(0,n.createElement)(d,null,e);s.Slot=({fillProps:e})=>(0,n.createElement)(i,{fillProps:e},(e=>e.length?e:null));const c=s,{Fill:y,Slot:m}=(0,u.createSlotFill)("AQLControlsInheritedQuery"),_=({children:e})=>(0,n.createElement)(y,null,e);_.Slot=m;const p=_,{Fill:q,Slot:h}=(0,u.createSlotFill)("AQLLegacyControls"),g=({children:e})=>(0,n.createElement)(q,null,e);g.Slot=({fillProps:e})=>(0,n.createElement)(h,{fillProps:e},(e=>e.length?e:null));const v=g,E={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let b;const f=new Uint8Array(16);function x(){if(!b&&(b="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!b))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return b(f)}const C=[];for(let e=0;e<256;++e)C.push((e+256).toString(16).slice(1));const w=function(e,t,r){if(E.randomUUID&&!t&&!e)return E.randomUUID();const a=(e=e||{}).random||(e.rng||x)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return C[e[t+0]]+C[e[t+1]]+C[e[t+2]]+C[e[t+3]]+"-"+C[e[t+4]]+C[e[t+5]]+"-"+C[e[t+6]]+C[e[t+7]]+"-"+C[e[t+8]]+C[e[t+9]]+"-"+C[e[t+10]]+C[e[t+11]]+C[e[t+12]]+C[e[t+13]]+C[e[t+14]]+C[e[t+15]]}(a)},S=window.wp.coreData,T=window.wp.element,k=["=","!=",">",">=","<","<=","LIKE","NOT LIKE","IN","NOT IN","BETWEEN","NOT BETWEEN","EXISTS","NOT EXISTS","REGEXP","NOT REGEXP","RLIKE"],N=["CHAR","NUMERIC","BINARY","DATE","DATETIME","DECIMAL","SIGNED","TIME","UNSIGNED"],A={marginTop:"0.75em",marginBottom:"0.75em"},B=({registeredMetaKeys:e,id:t,queries:r,attributes:l,setAttributes:o})=>{const d=r.find((e=>e.id===t)),[i,s]=(0,T.useState)(!1),[c,y]=(0,T.useState)(!1);(0,T.useEffect)((()=>{d?.meta_type&&"CHAR"!==d?.meta_type||d?.meta_compare&&"="!==d?.meta_compare?(s(!0),y(!0)):y(!1)}),[d?.meta_type,d?.meta_compare]);const m=(e,t,r,a)=>e.map((e=>e.id===t?{...e,[r]:a}:e));return(0,n.createElement)(n.Fragment,null,(0,n.createElement)(u.FormTokenField,{label:(0,a.__)("Meta Key","advanced-query-loop"),value:d?.meta_key?.length?[d.meta_key]:[],__experimentalShowHowTo:!1,suggestions:e,maxLength:1,onChange:e=>{o({query:{...l.query,meta_query:{...l.query.meta_query,queries:m(r,t,"meta_key",e[0])}}})}}),d?.meta_key?.length>0&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)(u.TextControl,{label:(0,a.__)("Meta Value","advanced-query-loop"),value:d.meta_value,onChange:e=>{o({query:{...l.query,meta_query:{...l.query.meta_query,queries:m(r,t,"meta_value",e)}}})}}),i&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)(u.SelectControl,{label:(0,a.__)("Meta Compare","advanced-query-loop"),value:d.meta_compare,options:[...k.map((e=>({label:e,value:e})))],onChange:e=>{o({query:{...l.query,meta_query:{...l.query.meta_query,queries:m(r,t,"meta_compare",e)}}})}}),(0,n.createElement)(u.SelectControl,{label:(0,a.__)("Meta Type","advanced-query-loop"),value:d.meta_type,options:[...N.map((e=>({label:e,value:e})))],onChange:e=>{o({query:{...l.query,meta_query:{...l.query.meta_query,queries:m(r,t,"meta_type",e)}}})},__nextHasNoMarginBottom:!0}))),(0,n.createElement)("hr",null),(0,n.createElement)(u.__experimentalHStack,{alignment:d?.meta_key?"edge":"right",style:A},d?.meta_key&&(0,n.createElement)(u.ToggleControl,{checked:i,label:(0,a.__)("Advanced mode","advanced-query-loop"),onChange:()=>s(!i),disabled:c}),(0,n.createElement)(u.Button,{key:t,variant:"secondary",size:"small",isDestructive:!0,onClick:()=>{const e=r.filter((e=>e.id!==t));o({query:{...l.query,meta_query:{...l.query.meta_query,queries:e}}})}},(0,a.__)("Remove query","advanced-query-loop"))),(0,n.createElement)("hr",null),(0,n.createElement)("br",null))},D=window.wp.data,P=({attributes:e,setAttributes:t,allowedControls:r})=>{const{query:{postType:l,meta_query:{relation:o="",queries:d=[]}={}}={}}=e,{records:i}=(0,S.useEntityRecords)("postType",l,{per_page:1}),[s]=(0,T.useState)(l);if((0,T.useEffect)((()=>{l!==s&&t({query:{...e.query,meta_query:{}}})}),[l]),!r.includes("post_meta_query"))return null;const c=(e=>({...e?.[0]?.meta,...e?.[0]?.acf}))(i);return(0,n.createElement)(n.Fragment,null,(0,n.createElement)(u.Dropdown,{popoverProps:{placement:"left-start",offset:36},renderToggle:({isOpen:e,onToggle:t})=>(0,n.createElement)(u.Button,{variant:e?"primary":"secondary",onClick:t,"aria-haspopup":"true","aria-expanded":e,disabled:0===Object.keys(c).length},e?(0,a.__)("Close Post meta query builder","advanced-query-loop"):(0,a.__)("Open Post Meta query builder","advanced-query-loop")),renderContent:()=>(0,n.createElement)(u.__experimentalDropdownContentWrapper,{paddingSize:"none",style:{width:"30rem"}},(0,n.createElement)(u.Panel,{header:(0,a.__)("Meta Query Builder","advanced-query-loop")},(0,n.createElement)(u.PanelBody,null,d.length>1&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)(u.ToggleControl,{label:(0,a.__)("Match Any Condition","advanced-query-loop"),help:(0,a.__)("By default, conditions are combined using the AND operator, meaning all conditions must be met. Enable this option to use the OR operator instead, allowing results that match any of the conditions.","advanced-query-loop"),checked:"OR"===o,onChange:()=>{t({query:{...e.query,meta_query:{...e.query.meta_query,relation:"OR"===e.query.meta_query.relation?"AND":"OR"}}})},__nextHasNoMarginBottom:!1}),(0,n.createElement)("hr",null)),d.map((({id:r,meta_key:a,meta_value:l,compare:o})=>(0,n.createElement)(B,{key:r,id:r,metaKey:a,metaValue:l,metaCompare:o,registeredMetaKeys:Object.keys(c),queries:d,attributes:e,setAttributes:t}))),(0,n.createElement)(u.__experimentalHStack,null,(0,n.createElement)(u.Button,{variant:"primary",onClick:()=>{const r=[...d,{id:w(),meta_key:"",meta_value:"",meta_compare:""}];t({query:{...e.query,meta_query:{...e.query.meta_query,queries:r}}})}},(0,a.__)("Add new query","advanced-query-loop")),d.length>0&&(0,n.createElement)(u.Button,{variant:"primary",isDestructive:!0,onClick:()=>{t({query:{...e.query,meta_query:{}}})}},(0,a.__)("Reset queries","advanced-query-loop"))))))}))},M=({attributes:e,setAttributes:t,allowedControls:r})=>{const{query:{date_query:{relation:l="",date_primary:o=new Date,date_secondary:d=new Date,inclusive:i=!1,range:s="",current_date_in_range:c=!1}={}}={}}=e;return(0,n.createElement)(n.Fragment,null,(0,n.createElement)("h2",null,(0,a.__)("Post Date Query","advanced-query-loop")),r.includes("date_query_dynamic_range")&&(0,n.createElement)(u.SelectControl,{label:(0,a.__)("Dynamic Range","advanced-query-loop"),help:(0,a.__)("Show posts from the last month, 3 months, 6 months, or 12 months. Posts are shown from the 1st of the month.","advanced-query-loop"),value:s,disabled:""!==l,options:[{label:(0,a.__)("None","advanced-query-loop"),value:""},{label:(0,a.__)("Last month","advanced-query-loop"),value:"last-month"},{label:(0,a.__)("Last 3 months","advanced-query-loop"),value:"three-months"},{label:(0,a.__)("Last 6 months","advanced-query-loop"),value:"six-months"},{label:(0,a.__)("Last 12 months","advanced-query-loop"),value:"twelve-months"}],onChange:r=>{t({query:{...e.query,date_query:{...e.query.date_query,range:r}}})},__nextHasNoMarginBottom:!0}),""!==s&&r.includes("date_query_dynamic_range")&&(0,n.createElement)(u.CheckboxControl,{label:(0,a.__)("Include up to current date","advanced-query-loop"),help:(0,a.__)("Should the dynamic range include up to the current date?","advanced-query-loop"),disabled:""===s,checked:c,onChange:r=>{t({query:{...e.query,date_query:{...e.query.date_query,current_date_in_range:r}}})}}),r.includes("date_query_relationship")&&(0,n.createElement)(u.SelectControl,{label:(0,a.__)("Date Relationship","advanced-query-loop"),help:(0,a.__)("Show posts before or after the current date, or before, after, or between specific dates.","advanced-query-loop"),value:l,disabled:r.includes("date_query_dynamic_range")&&""!==s,options:[{label:(0,a.__)("None","advanced-query-loop"),value:""},{label:(0,a.__)("Before current date","advanced-query-loop"),value:"before-current"},{label:(0,a.__)("After current date","advanced-query-loop"),value:"after-current"},{label:(0,a.__)("Before specific date","advanced-query-loop"),value:"before"},{label:(0,a.__)("After specific date","advanced-query-loop"),value:"after"},{label:(0,a.__)("Between specific dates","advanced-query-loop"),value:"between"}],onChange:r=>{t({query:{...e.query,date_query:""!==r?{...e.query.date_query,relation:r}:""}})},__nextHasNoMarginBottom:!0}),""!==l&&!l.includes("current")&&r.includes("date_query_relationship")&&(0,n.createElement)(n.Fragment,null,"between"===l&&(0,n.createElement)("h4",null,(0,a.__)("Start date","advanced-query-loop")),(0,n.createElement)(u.DatePicker,{currentDate:o,onChange:r=>{t({query:{...e.query,date_query:{...e.query.date_query,date_primary:r}}})}}),"between"===l&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)("h4",null,(0,a.__)("End date","advanced-query-loop")),(0,n.createElement)(u.DatePicker,{currentDate:d,onChange:r=>{t({query:{...e.query,date_query:{...e.query.date_query,date_secondary:r}}})}})),(0,n.createElement)("br",null),(0,n.createElement)(u.CheckboxControl,{label:(0,a.__)("Include selected date(s)","advanced-query-loop"),help:(0,a.__)("Should the selected date(s) be included in your query?","advanced-query-loop"),checked:i,onChange:r=>{t({query:{...e.query,date_query:{...e.query.date_query,inclusive:r}}})}})))},I=({attributes:e,setAttributes:t,allowedControls:r})=>{const{query:{multiple_posts:l=[],postType:o}={}}=e,d=(0,D.useSelect)((e=>e(S.store).getPostTypes({per_page:50})?.filter((({viewable:e})=>e))?.map((({slug:e})=>e))),[]);return r.includes("additional_post_types")?d?(0,n.createElement)(u.BaseControl,{help:(0,a.__)("These post types will be queried in addition to the main post type.","advanced-query-loop"),__nextHasNoMarginBottom:!0},(0,n.createElement)(u.FormTokenField,{label:(0,a.__)("Additional Post Types","advanced-query-loop"),value:[...l.filter((e=>e!==o))],suggestions:[...d?.filter((e=>e!==o))],onChange:r=>{t({query:{...e.query,multiple_posts:r||[]}})},__experimentalExpandOnFocus:!0,__experimentalShowHowTo:!1,__nextHasNoMarginBottom:!0})):(0,n.createElement)("div",null,(0,a.__)("Loading…","advanced-query-loop")):null},F=[{label:(0,a.__)("Name","advanced-query-loop"),value:"name"},{label:(0,a.__)("Author","advanced-query-loop"),value:"author"},{label:(0,a.__)("Comment Count","advanced-query-loop"),value:"comment_count"},{label:(0,a.__)("Date","advanced-query-loop"),value:"date"},{label:(0,a.__)("Included Posts","advanced-query-loop"),value:"post__in"},{label:(0,a.__)("Last Modified Date","advanced-query-loop"),value:"modified"},{label:(0,a.__)("Menu Order","advanced-query-loop"),value:"menu_order"},{label:(0,a.__)("Meta Value","advanced-query-loop"),value:"meta_value"},{label:(0,a.__)("Meta Value Num","advanced-query-loop"),value:"meta_value_num"},{label:(0,a.__)("Post ID","advanced-query-loop"),value:"id"},{label:(0,a.__)("Random","advanced-query-loop"),value:"rand"},{label:(0,a.__)("Title","advanced-query-loop"),value:"title"}],O=({attributes:e,setAttributes:t,allowedControls:r})=>{const{query:{order:l,orderBy:o}={}}=e;return r.includes("post_order")?(0,n.createElement)(n.Fragment,null,(0,n.createElement)(u.SelectControl,{label:(0,a.__)("Post Order By","advanced-query-loop"),value:o,help:"meta_value"===o||"meta_value_num"===o?(0,a.__)("Meta Value and Meta Value Num require that Meta Key is set in the Meta Query section.","advanced-query-loop"):"",options:F.sort(((e,t)=>e.label.localeCompare(t.label))),onChange:r=>{t({query:{...e.query,orderBy:r}})},__nextHasNoMarginBottom:!0}),(0,n.createElement)(u.ToggleControl,{label:(0,a.__)("Ascending Order","advanced-query-loop"),checked:"asc"===l,onChange:()=>{t({query:{...e.query,order:"asc"===l?"desc":"asc"}})},__nextHasNoMarginBottom:!0})):null},H=window.wp.htmlEntities,R=({attributes:e,setAttributes:t,allowedControls:r})=>{const{query:{exclude_current:l,exclude_posts:o=[]}={}}=e;return r.includes("exclude_current_post")||r.includes("exclude_posts")?(0,n.createElement)(n.Fragment,null,(0,n.createElement)("h2",null," ",(0,a.__)("Exclude Posts","advanced-query-loop")),(0,n.createElement)(L,{attributes:e,setAttributes:t,allowedControls:r}),(0,n.createElement)(Q,{attributes:e,setAttributes:t,allowedControls:r})):null},L=({attributes:e,setAttributes:t,allowedControls:r})=>{const{query:{exclude_current:l}={}}=e,{record:o}=(0,S.useEntityRecord)("root","site"),{currentPost:d,isAdmin:i}=(0,D.useSelect)((e=>({currentPost:e("core/editor").getCurrentPost(),isAdmin:e(S.store).canUser("update",{kind:"root",name:"site"})})),[]);if(!r.includes("exclude_current_post"))return null;if(!d)return(0,n.createElement)("div",null,(0,a.__)("Loading…","advanced-query-loop"));const s=()=>{if(!i)return!1;const{show_on_front:e}=o,t=["archive","search",..."posts"===e?["home","front-page"]:[]];return"wp_template"===d.type&&t.includes(d.slug)};return(0,n.createElement)(u.ToggleControl,{__nextHasNoMarginBottom:!0,label:(0,a.__)("Exclude Current Post","advanced-query-loop"),checked:!!l,disabled:s(),onChange:r=>{t({query:{...e.query,exclude_current:r?d.id:0}})},help:s()?(0,a.__)("This option is disabled for this template as there is no dedicated post to exclude.","advanced-query-loop"):(0,a.__)("Remove the associated post for this template/content from the query results.","advanced-query-loop")})},Q=({attributes:e,setAttributes:t,allowedControls:r})=>{const{query:{exclude_posts:l=[],multiple_posts:o=[],postType:d}={}}=e,i=(0,D.useSelect)((e=>{const{getEntityRecords:t}=e("core");return[...o,d].reduce(((e,r)=>[...e,...t("postType",r,{per_page:-1})||[]]),[])}),[d,o]);return r.includes("exclude_posts")?i?(0,n.createElement)(u.BaseControl,{help:(0,a.__)("Start typing to search for a post title to exclude, or manually enter one.","advanced-query-loop")},(0,n.createElement)(u.FormTokenField,{label:(0,a.__)("Posts to Exclude","advanced-query-loop"),value:l.flatMap((e=>(e=>{const t=i.find((t=>t.id===e));return t?[(0,H.decodeEntities)(t.title.rendered.trim())]:[]})(e))),suggestions:i.map((e=>(0,H.decodeEntities)(e.title.rendered.trim()))),onChange:r=>{t({query:{...e.query,exclude_posts:r.flatMap((e=>(e=>{const t=i.find((t=>(0,H.decodeEntities)(t.title.rendered.trim())===e));return t?[t.id]:[]})(e)))||[]}})},__experimentalExpandOnFocus:!0,__experimentalShowHowTo:!1})):(0,n.createElement)("div",null,(0,a.__)("Loading…","advanced-query-loop")):null},z=window.wp.compose,U=(e,t,r,a)=>e.map((e=>e.id===t?{...e,[r]:a}:e)),V=["EXISTS","NOT EXISTS","AND"],K=["IN","NOT IN",...V],j={marginTop:"1.5em",marginBottom:"0.75em"},X=({id:e,taxonomy:t,terms:r,operator:l,includeChildren:o,availableTaxonomies:d,attributes:i,setAttributes:s})=>{const[c,y]=((e,t)=>{const[r,a]=(0,T.useState)(e);return[r,(0,z.useDebounce)(a,t)]})("",500),[m,_]=(0,T.useState)(!1),[p,q]=(0,T.useState)(!1),{records:h}=(0,S.useEntityRecords)("taxonomy",t,{per_page:10,search:c,_fields:"id,name",context:"view"}),g=(0,T.useMemo)((()=>(null!=h?h:[]).map((e=>e.name))),[h]);return(0,T.useEffect)((()=>{V.includes(l)||!1===o?(_(!0),q(!0)):q(!1)}),[l,o]),(0,n.createElement)(n.Fragment,null,(0,n.createElement)(u.SelectControl,{label:(0,a.__)("Taxonomy","advanced-query-loop"),value:t,options:[{label:"Choose taxonomy",value:""},...d.map((({name:e,slug:t})=>({label:e,value:t})))],onChange:t=>{s({query:{...i.query,tax_query:{...i.query.tax_query,queries:U(i.query.tax_query.queries,e,"taxonomy",t)}}})},__next40pxDefaultSize:!0}),t.length>1&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)(u.FormTokenField,{label:(0,a.__)("Terms","advanced-query-loop"),suggestions:g,value:r,onInputChange:e=>{y(e)},onChange:t=>{s({query:{...i.query,tax_query:{...i.query.tax_query,queries:U(i.query.tax_query.queries,e,"terms",t)}}})},__next40pxDefaultSize:!0}),m?(0,n.createElement)(n.Fragment,null,(0,n.createElement)(u.SelectControl,{label:(0,a.__)("Operator","advanced-query-loop"),value:l,options:[...K.map((e=>({label:e,value:e})))],onChange:t=>{s({query:{...i.query,tax_query:{...i.query.tax_query,queries:U(i.query.tax_query.queries,e,"operator",t)}}})},__next40pxDefaultSize:!0}),(0,n.createElement)("div",{style:j},(0,n.createElement)(u.ToggleControl,{label:(0,a.__)("Include children","advanced-query-loop"),className:"advanced-query-loop__include-children",checked:o,onChange:t=>{s({query:{...i.query,tax_query:{...i.query.tax_query,queries:U(i.query.tax_query.queries,e,"include_children",t)}}})},__next40pxDefaultSize:!0}))):(0,n.createElement)(u.ToggleControl,{label:(0,a.__)("Exclude these terms from the query","advanced-query-loop"),checked:"NOT IN"===l,onChange:()=>{const t=i.query.tax_query.queries.find((t=>t.id===e));s({query:{...i.query,tax_query:{...i.query.tax_query,queries:U(i.query.tax_query.queries,e,"operator","IN"===t.operator?"NOT IN":"IN")}}})},__next40pxDefaultSize:!0})),(0,n.createElement)("hr",null),(0,n.createElement)(u.__experimentalHStack,{alignment:t?"edge":"right",style:j},t&&(0,n.createElement)(u.ToggleControl,{checked:m,label:(0,a.__)("Advanced mode","advanced-query-loop"),onChange:()=>_(!m),disabled:p,__nextHasNoMarginBottom:!0}),(0,n.createElement)(u.Button,{key:e,variant:"secondary",size:"small",isDestructive:!0,onClick:()=>s({query:{...i.query,tax_query:{...i.query.tax_query,queries:i.query.tax_query.queries.filter((({id:t})=>t!==e))}}})},(0,a.__)("Remove query","advanced-query-loop"))),(0,n.createElement)("hr",null),(0,n.createElement)("br",null))},G=({attributes:e,setAttributes:t,allowedControls:r})=>{const{query:{postType:l,multiple_posts:o=[],tax_query:{relation:d="",queries:i=[]}={}}={}}=e,s=(0,D.useSelect)((e=>e(S.store).getTaxonomies({per_page:50})?.filter((({types:e})=>e.some((e=>[l,...o].includes(e)))))));return r.includes("taxonomy_query_builder")?(0,n.createElement)(n.Fragment,null,(0,n.createElement)(u.Dropdown,{popoverProps:{placement:"left-start",offset:36},renderToggle:({isOpen:e,onToggle:t})=>(0,n.createElement)(u.Button,{variant:e?"primary":"secondary",onClick:t,"aria-haspopup":"true","aria-expanded":e,disabled:0===s.length},e?(0,a.__)("Close Taxonomy query builder","advanced-query-loop"):(0,a.__)("Open Taxonomy query builder","advanced-query-loop")),renderContent:()=>(0,n.createElement)(u.__experimentalDropdownContentWrapper,{paddingSize:"none",style:{width:"30rem"}},(0,n.createElement)(u.Panel,{header:(0,a.__)("Taxonomy Query Builder","advanced-query-loop")},(0,n.createElement)(u.PanelBody,null,i.length>1&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)(u.ToggleControl,{label:(0,a.__)("Combine filters","advanced-query-loop"),help:(0,a.__)("By default, filters are combined with the OR operator. Enable this option to combine filters with the AND operator.","advanced-query-loop"),checked:"AND"===d,onChange:()=>{t({query:{...e.query,tax_query:{...e.query.tax_query,relation:"OR"===e.query.tax_query.relation?"AND":"OR"}}})},__nextHasNoMarginBottom:!1}),(0,n.createElement)("hr",null)),i.map((({id:r,taxonomy:a,terms:l,operator:o,include_children:u})=>(0,n.createElement)(X,{key:r,taxonomy:a,operator:o,terms:l,id:r,relation:d,includeChildren:u,availableTaxonomies:s,setAttributes:t,attributes:e}))),(0,n.createElement)(u.__experimentalHStack,null,(0,n.createElement)(u.Button,{variant:"primary",onClick:()=>{t({query:{...e.query,tax_query:{relation:d||"OR",queries:[...i,{id:w(),taxonomy:"",terms:[],include_children:!0,operator:"IN"}]}}})}},(0,a.__)("Add new query","advanced-query-loop")),i.length>0&&(0,n.createElement)(u.Button,{variant:"primary",isDestructive:!0,onClick:()=>{t({query:{...e.query,tax_query:[]}})}},(0,a.__)("Reset queries","advanced-query-loop"))))))})):null},W=({attributes:e,setAttributes:t,allowedControls:r})=>{const{query:{include_posts:l=[],postType:o,multiple_posts:d=[],exclude_current:i=0}={}}=e,[s,c]=(0,T.useState)(""),[y,m]=(0,T.useState)(d),_=(0,D.useSelect)((e=>{const{getEntityRecords:t}=e("core");return[...d,o].reduce(((e,r)=>[...e,...t("postType",r,{per_page:10,search:s,exclude:i?[i]:[]})||[]]),[])}),[o,d,i,s]);return(0,T.useEffect)((()=>{JSON.stringify(d)!==JSON.stringify(y)&&(t({query:{...e.query,include_posts:[]}}),m(d))}),[d]),r.includes("include_posts")?_?_.length>0&&!_[0].title?null:(0,n.createElement)(n.Fragment,null,(0,n.createElement)("h2",null," ",(0,a.__)("Include Posts","advanced-query-loop")),(0,n.createElement)(u.BaseControl,{help:(0,a.__)("Start typing to search for a post title or manually enter one.","advanced-query-loop"),__nextHasNoMarginBottom:!0},(0,n.createElement)(u.FormTokenField,{label:(0,a.__)("Posts","advanced-query-loop"),value:l.map((e=>(0,H.decodeEntities)(e.title))),suggestions:_.map((e=>(0,H.decodeEntities)(e?.title?.rendered||""))),onInputChange:e=>c(e),onChange:r=>{t({query:{...e.query,include_posts:r.map((e=>(e=>{const t=l.find((t=>(0,H.decodeEntities)(t.title)===e))||_.find((t=>(0,H.decodeEntities)(t.title.rendered.trim())===e));return t.title.rendered?{id:t.id,title:t.title.rendered}:t})(e)))||[]}}),c("")},__experimentalExpandOnFocus:!0,__experimentalShowHowTo:!1,__nextHasNoMarginBottom:!0}))):(0,n.createElement)("div",null,(0,a.__)("Loading…","advanced-query-loop")):null},J=({attributes:e,setAttributes:t,allowedControls:r})=>{const{query:{disable_pagination:l}={}}=e;return r.includes("pagination")?(0,n.createElement)(u.ToggleControl,{label:(0,a.__)("Disable pagination","advanced-query-loop"),help:(0,a.__)("Disabling pagination will not show any pagination controls on the front end. It can also provide a performance improvement for complicated queries.","advanced-query-loop"),checked:!!l,onChange:()=>{t({query:{...e.query,disable_pagination:!l}})},__nextHasNoMarginBottom:!0}):null},Y=window.wp.editor,$=({attributes:e,setAttributes:t,allowedControls:r})=>{const{query:{post_parent:l}={}}=e,{isHierarchial:o,postTypeName:d,postID:i}=(0,D.useSelect)((e=>{const t=e(Y.store).getCurrentPost(),r=e(Y.store).getCurrentPostType(),a=e(S.store).getPostType(r);return{isHierarchial:a?.hierarchical,postTypeName:r,postID:t?.id}}),[]);return r.includes("child_items_only")?(0,n.createElement)(u.ToggleControl,{__nextHasNoMarginBottom:!0,label:(0,a.__)("Show child items only","advanced-query-loop"),help:(0,a.__)("Only show child items of this item. This option is only available for hierarchical post types such as pages.","advanced-query-loop"),disabled:!o&&"wp_template"!==d,checked:!!l,onChange:r=>t({query:{...e.query,post_parent:r?i:0}})}):null};(0,l.addFilter)("editor.BlockEdit","aql/add-add-controls/core/query",(e=>t=>{if((e=>{const{attributes:{namespace:t}}=e;return t&&t===ee})(t)){const{allowedControls:r}=window?.aql,{attributes:l}=t,d=r.split(","),i={...t,allowedControls:d};return l.query.inherit?(0,n.createElement)(n.Fragment,null,(0,n.createElement)(e,{...t}),(0,n.createElement)(o.InspectorControls,null,(0,n.createElement)(u.PanelBody,{title:(0,a.__)("Advanced Query Settings","advanced-query-loop")},(0,n.createElement)(O,{...i}),(0,n.createElement)(p.Slot,{fillProps:{...i}})))):(0,n.createElement)(n.Fragment,null,(0,n.createElement)(e,{...t}),(0,n.createElement)(o.InspectorControls,null,(0,n.createElement)(u.PanelBody,{title:(0,a.__)("Advanced Query Settings","advanced-query-loop")},(0,n.createElement)(v.Slot,{fillProps:{...i}}),(0,n.createElement)(I,{...i}),(0,n.createElement)(u.BaseControl,{label:(0,a.__)("Query Builders","advanced-query-loop"),id:"query-builders"},(0,n.createElement)(u.__experimentalVStack,{alignment:"center"},(0,n.createElement)(G,{...i}),(0,n.createElement)(P,{...i}))),(0,n.createElement)(O,{...i}),(0,n.createElement)(R,{...i}),(0,n.createElement)(W,{...i}),(0,n.createElement)($,{...i}),(0,n.createElement)(M,{...i}),(0,n.createElement)(J,{...i}),(0,n.createElement)(c.Slot,{fillProps:{...i}}))))}return(0,n.createElement)(e,{...t})})),(0,l.addFilter)("blocks.registerBlockType","aql/add-transforms/query-block",(function(e,t){return"core/query"!==t?e:{...e,keywords:[...e.keywords,"AQL","aql"],transforms:{to:e?.transforms?.to||[],from:[...e?.transforms?.from||[],{type:"enter",regExp:/^(AQL|aql)$/,transform:()=>(0,r.createBlock)("core/query",{namespace:"advanced-query-loop"},[])}]}}}));const Z=window.wp.primitives,ee="advanced-query-loop";(0,r.registerBlockVariation)("core/query",{name:ee,title:(0,a.__)("Advanced Query Loop","advanced-query-loop"),description:(0,a.__)("Create advanced queries","advanced-query-loop"),icon:function(){return(0,n.createElement)(Z.SVG,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24"},(0,n.createElement)(Z.Path,{fill:"#2D2B55",d:"M0 0h24v24H0V0z"}),(0,n.createElement)(Z.Path,{fill:"#fff",d:"M17.936 8.438h1.217v6.125h2.867v1.093h-4.084V8.437zM10.364 12.047c0 .515.11.97.33 1.361.22.392.519.701.897.928.385.22.815.33 1.289.33.481 0 .907-.106 1.279-.32.371-.22.663-.522.876-.907.213-.385.32-.825.32-1.32 0-.495-.107-.942-.32-1.34a2.455 2.455 0 00-.886-.95c-.372-.233-.812-.35-1.32-.35-.475 0-.898.11-1.269.33-.371.22-.663.526-.877.918-.213.385-.32.825-.32 1.32zm-1.29 0c0-.543.094-1.042.28-1.495.192-.454.456-.846.793-1.176a3.685 3.685 0 011.197-.784c.46-.185.955-.278 1.485-.278.543 0 1.041.093 1.495.278a3.57 3.57 0 011.186.784c.337.33.598.722.784 1.176.185.453.278.952.278 1.495 0 .536-.093 1.034-.278 1.495-.186.46-.447.86-.784 1.196-.33.337-.722.602-1.176.795a3.941 3.941 0 01-1.505.278 3.964 3.964 0 01-1.496-.278 3.676 3.676 0 01-1.196-.795 3.545 3.545 0 01-.784-1.196 3.964 3.964 0 01-.278-1.495zm3.425.515H13.9l3.248 3.146h-1.433l-3.217-3.146z"}),(0,n.createElement)(Z.Path,{fill:"#E76F51",d:"M3.546 13.8l.227-1.031h3.351l.237 1.031H3.546zm1.887-3.32l-1.134 2.65-.021.268-1 2.258H1.906l3.527-7.62 3.527 7.62H7.588l-.98-2.196-.03-.3-1.145-2.68z"}))},isActive:["namespace"],attributes:{namespace:ee},scope:["inserter","transform"]}),aql=t})();